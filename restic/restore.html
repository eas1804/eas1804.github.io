<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Restic. restore</title>
    <link rel="stylesheet" href="../style.css">
  </head>
<body>
<h2>Восстановление<h2>
<h3>Windows по SSH. port 23. your-storagebox.de</h3>
ID - идентификатор snapshot
<table><tr><td><pre>
@echo off
set PORT=23
set REMOTE_HOST=u12345.your-storagebox.de
set REMOTE_USER=u12345
set REMOTE_PATH=/home/restic
set SSH_KEY_PATH=C:/Users/us/.ssh/tor.key
set RESTIC_PASSWORD_FILE=C:/Users/us/restic-password.txt


set ID=6ab87b9a
set TAGRET=D:\ca
restic -r sftp:%REMOTE_USER%@%REMOTE_HOST%:%REMOTE_PATH% -o "sftp.command=ssh -i %SSH_KEY_PATH% -p %PORT% -o StrictHostKeyChecking=no %REMOTE_USER%@%REMOTE_HOST% -s sftp"  restore %ID% --target %TAGRET%
pause
</pre></td></tr></table>
<h3>Монтирование репозитория в Linux"</h3>
<p>1. Если не установлено - установить
<p><code> apt install fuse3</code>
<p>Проверить
<p> <code>modprobe fuse</code>
<p> 2. Указать репозиторий и пароль (через переменные окружения)
<p> <code>export RESTIC_REPOSITORY=/mnt/restic/users/unac/</code>
<p><code>export RESTIC_PASSWORD=MyPassword</code>
<p> 3. Смонтировать
<p><code>restic mount /mnt/restore/</code>
<p> Смонтировать последний снимок
<p><code>restic mount --snapshot latest /mnt/restore</code>

<h3> Скрипт монтирования удаленного репозитория по SSH </h3>
<table><tr><td><pre>
#!/bin/bash

# Настройки подключения
PORT=22
REMOTE_HOST="backup12345.backup.1cloudlab.com"
REMOTE_USER="backup12345"
REMOTE_PATH="/backup/restic/refacon/"

# Пути к ключам и паролям
SSH_KEY_PATH="/mnt/restic/all-key/Refacon"
RESTIC_PASSWORD_FILE="/mnt/restic/all-key/Refacon.password"

# Точка монтирования
MOUNT_POINT="/mnt/restore/"

echo  "Последний снапшот" ВСЕГДА доступен по этому пути:
echo  LATEST_PATH="${MOUNT_POINT}snapshots/latest"

# Выполнение монтирования всего репозитория
restic -r "sftp:${REMOTE_USER}@${REMOTE_HOST}:${REMOTE_PATH}" \
  --password-file "${RESTIC_PASSWORD_FILE}" \
  -o "sftp.command=ssh -i ${SSH_KEY_PATH} -p ${PORT} -o StrictHostKeyChecking=no ${REMOTE_USER}@${REMOTE_HOST} -s sftp" \
  mount "$MOUNT_POINT"
</pre></td></tr></table>

</body>

