<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Restic. init</title>
    <link rel="stylesheet" href="../style.css">
  </head>
<body>
<h2>Установка в Debian</h2>
<table><tr><td><pre>
apt update
apt install wget bzip2 -y
cd /tmp
LATEST=$(curl -s https://api.github.com/repos/restic/restic/releases/latest | grep browser_download_url | grep linux_amd64.bz2 | cut -d '"' -f 4)
wget "$LATEST" -O restic.bz2
bunzip2 restic.bz2
chmod +x restic
mv restic /usr/local/bin/
type -a restic
</pre></td></tr></table>
<p>Проверить
<p><code>restic version</code>
<p>Если есть старая верися restic
<table><tr><td><pre>
mv /usr/bin/restic /usr/bin/restic.old
ln -s /usr/local/bin/restic /usr/bin/restic
</pre></td></tr></table>

<h2>Установка в Windows</h2>
Если у вас ещё не установлен Scoop, выполните в PowerShell (от имени обычного пользователя, не администратора!):
<table><tr><td><pre>
Set-ExecutionPolicy RemoteSigned -Scope CurrentUser
irm get.scoop.sh | iex
</pre></td></tr></table>
<p>Ставим restic
<p><code>scoop install restic</code>
<p>Проверка
<p><code>restic version</code>
<p>Простое обновление:
<p><code>scoop update restic</code>




<h2>Инициировать репозиторий. Windows</h2>
<p>Если клиент ssh не установлен в Windows – его нужно установить. <a href=https://github.com/PowerShell/Win32-OpenSSH/releases>Вот ссылка на github</a>

<h3>Локальный репозиторий</h3>
<p><code>restic init --repo F:\Restic_backup</code>

<h3>AWS</h3>
<p><code>restic init --repo s3:s3.amazonaws.com/ИмяТвоегоБакета/restic</code>
<p><code>restic init --repo s3:s3.amazonaws.com/shamoev.restic/restic</code>



<h3>Скрипт ssh для hetzner.com (ssh 23/tcp)</h3>

<table><tr><td><pre>
@echo off
set PORT=23
set REMOTE_HOST=u12345.your-storagebox.de
set REMOTE_USER=u12345
set REMOTE_PATH=/home/company
set SSH_KEY_PATH=C:/Users/us/.ssh/stor.key
set RESTIC_PASSWORD_FILE=C:/Users/us/restic-password.txt

restic -r sftp:%REMOTE_USER%@%REMOTE_HOST%:%REMOTE_PATH% -o "sftp.command=ssh -i %SSH_KEY_PATH% -p %PORT% -o StrictHostKeyChecking=no %REMOTE_USER%@%REMOTE_HOST% -s sftp" init
pause
exit 0
</pre></td></tr></table>



<h3>Linux SSH</h3>
<table><tr><td><pre>
#!/bin/bash

PORT=23
REMOTE_HOST=u12345.your-storagebox.de
REMOTE_USER=u12345
REMOTE_PATH=/mnt/company/restic/
SSH_KEY_PATH=/root/.ssh/company_key
RESTIC_PASSWORD_FILE=/root/restic-password.txt

export RESTIC_PASSWORD_FILE

restic -r "sftp:${REMOTE_USER}@${REMOTE_HOST}:${REMOTE_PATH}" \
  -o "sftp.command=ssh -i ${SSH_KEY_PATH} -p ${PORT} -o StrictHostKeyChecking=no ${REMOTE_USER}@${REMOTE_HOST} -s sftp" \
  init

</pre></td></tr></table>




</body>

