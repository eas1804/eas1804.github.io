<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>proxmox</title>
    <link rel="stylesheet" href="../style.css">
  </head>

<body>
<ol>
<h3><li>ZFS для NVME/SSD</h3>
<p><code>zpool set5 autotrim=on rpool</code>
<p>Проверить статус
<p><code>zpool get autotrim rpool</code>
<p>Это поможет NVMe контроллерам своевременно очищать блоки и сохранять высокую скорость записи в долгосроке.
<h3><li>кэш чтения ZFS в RAM</h3>
<a href=zfs.html>Рекомендации по ARC для разных объемов ОЗУ</a>
<h3><li>Проверить, включено ли перенаправление пакетов</h3>
<p><code>sysctl net.ipv4.ip_forward</code>
<table><tr><td><pre>
echo "net.ipv4.ip_forward=1" > /etc/sysctl.d/99-forward.conf
systemctl restart systemd-sysctl
</pre></tr></td></table>
<h3><li>nftables.conf </h3>
<table><tr><td><pre>
wget https://eas1804.github.io/Proxmox/nftables.conf
mv nftables.conf  /etc/
</pre></tr></td></table>
Создать vmbr1 для LAN
<h4>Запускает nftables только после завершения настройки сети</h4>
 <p><code>mkdir   /etc/systemd/system/nftables.service.d/</p></code>
 <p><code>nano  /etc/systemd/system/nftables.service.d/override.conf</p></code>
<table><tr><td><pre>
[Unit]
After=network-online.target
Wants=network-online.target
</pre></tr></td></table>
<p>After=network-online.target — запускает nftables только после завершения настройки сети.
<p>Wants=network-online.target — добавляет зависимость, чтобы network-online.target был также активирован.

<table><tr><td><pre>
 systemctl daemon-reexec
 systemctl daemon-reload
 systemctl enable nftables.service
 systemctl restart nftables.service
</pre></tr></td></table>

<h3><li>Сохранить серйиные номера носителей </h3>
<p><code>lsblk -o NAME,SERIAL | grep  nvme > /root/SERIAL.info</code>
<p><code>wget https://eas1804.github.io/Proxmox/nvme_in_file.sh</code>



<h3><li>Тестирование парамертров NVME</h3>
<p>Отправляет сообщение в случае проблемы
<p><code>wget https://eas1804.github.io/Proxmox/nvme_send_problesm_info.sh</code>


<h3><li>Изменить Репозиторий</h3>
<p>Узнать версию
<p><code>pveversion</code>
<H5>Верcия 9 PVE</H5>
<table><tr><td><pre>
echo "Types: deb
URIs: http://download.proxmox.com/debian/pve
Suites: trixie
Components: pve-no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg" >/etc/apt/sources.list.d/pve-no-subscription.sources
</pre></td></tr><table>
 <table><tr><td><pre>
 echo "Enabled: no" >> /etc/apt/sources.list.d/ceph.sources
 echo "Enabled: no" >> /etc/apt/sources.list.d/pve-enterprise.sources
</pre></td></tr><table>
  
<H5>Верcия 4 PBS</H5> 
 <table><tr><td><pre>
echo "Types: deb
URIs: http://download.proxmox.com/debian/pbs
Suites: trixie
Components: pbs-no-subscription
Signed-By: /usr/share/keyrings/proxmox-archive-keyring.gpg" >/etc/apt/sources.list.d/pbs-no-subscription.sources
</pre></td></tr><table>
 
 <table><tr><td><pre>
  echo "Enabled: no" >> /etc/apt/sources.list.d/pbs-enterprise.sources
</pre></td></tr><table>

<p>Закомментировать содержимое 
<p><code> nano /etc/apt/sources.list.d/ceph.list</code>
<p>tmux
<p><code>apt update && apt upgrade -y</code>

<h3><li>Добавить ПО</h3>
<p><code>apt install tmux mc htop -y</p></code>

<h3><li>Настройить оповещения  по email</h3>
<p>Протестировать
<p><code>Datacenter-Notoficcations-Notifications Targets-Modyfy</code>
<h3><li> Мониторинг Kuma, Zabbix</h3>
 <a href=
https://www.zabbix.com/ru/download?zabbix=7.0&os_distribution=debian&os_version=13&components=agent_2&db=&ws=
>Zabbix client 2 </a>
 Уточни ссылку
<table><tr><td><pre>
wget https://repo.zabbix.com/zabbix/7.0/debian/pool/main/z/zabbix-release/zabbix-release_latest_7.0+debian12_all.deb</code>
dpkg -i zabbix-release_latest_7.0+debian12_all.deb</code>
apt update</code>
apt install zabbix-agent2 -y</code>
</pre></tr></td></table>

<table><tr><td><pre>
 cd /etc/zabbix/
 cp zabbix_agent2.conf  zabbix_agent2.conf.ORGN
grep -v "^#" zabbix_agent2.conf | grep -v "^$" > 1.conf
mv 1.conf  zabbix_agent2.conf
nano zabbix_agent2.conf
</pre></tr></td></table>

<table><tr><td><pre>
systemctl  restart  zabbix-agent2.service
systemctl  status   zabbix-agent2.service
</pre></tr></td></table>



</ul>
</body>
  </html>
