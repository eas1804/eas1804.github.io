<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Rsync</title>
    <link rel="stylesheet" href="../../style.css">
  </head>

<body>

<hr>
<h2>Rsync</h2>
<p>Инкриментный Backup</p>

<pre>
#!/bin/bash
############# Задаем переменные ###############
# Папка, куда будем складывать архивы
SYST_DIR=/backup/

        ###### Создаем функцию ####################
backup_func (){

# Создаем папку для инкрементных бэкапов
mkdir -p ${SYST_DIR}${SRV_NAME}/increment/

# Запускаем непосредственно бэкап с параметрами
/usr/bin/rsync -avz --progress --delete  ${SRV_DIR} ${SYST_DIR}${SRV_NAME}/current/ --backup --backup-dir=${SYST_DIR}${SRV_NAME}/increment/`date +%Y-%m-%d`/

# Чистим папки с инкрементными архивами старше 30-ти дней
#/usr/bin/find ${SYST_DIR}${SRV_NAME}/increment/ -maxdepth 1 -type d -mtime +30 -exec rm -rf {} \;
date
echo "Finish backup ${SRV_DIR}"
}
        ################### конец функции ##########


### user1.Vladimir_J
SRV_DIR=/home/vladimir/SMB/
SRV_NAME=Vladimir_J
backup_func


### user2. Anna_P
SRV_DIR=/home/Anna_P/SMB/
SRV_NAME=Anna_P
backup_func
</pre>



</body>
  </html>
