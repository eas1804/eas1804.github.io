<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>swap</title>
    <link rel="stylesheet" href="../../style.css">
  </head>

<body>
<h2>Swap</h2>
<h3>Отключения swap (подкачки) в Debian</h3>
<ol>
<li>Убедитесь, что ваша система использует swap
<p><code>swapon -s</code></p>
<li>Отключите swap
<p><code>swapoff /dev/sda5</code></p>
<li>Удалите запись о swap из файла /etc/fstab 
<p><code>nano /etc/fstab</code></p>
</ol>
<h2>для ext4, xfs</h2>
<h3> Создать SWAP в виде файла а не раздела</h3>
<ol>
<li>Создайте файл для swap
<p><code>dd if=/dev/zero of=/swapfile bs=1M count=1024</code></p>
<p>создать файл swap размером 1 ГБ в корневой директории (/),
<li>Установите права доступа к файлу
<p><code>chmod 600 /swapfile</code></p>
<li>Преобразуйте файл в swap пространство 
<p><code>mkswap /swapfile</code></p>
<li>Включите swap
<p><code>swapon /swapfile</code></p>
<li>Сделайте swap файл постоянным после перезагрузки (nano /etc/fstab)
<p>Добавить строку
<p><code>/swapfile none swap sw 0 0</code></p>
<li>Проверьте, что swap активен
<p><code>swapon -s</code></p>

<h2>для ZFS</h2>
<li>Создаем ZVOL объемом 4 ГБ
<p><code>zfs create -V 4G -b $(getconf PAGESIZE) -o compression=zle -o logbias=throughput -o sync=always -o primarycache=metadata -o secondarycache=none rpool/swap</code></p>
<p>Здесь мы отключаем лишнее кэширование и сжатие, чтобы swap работал максимально быстро.
<li> Проверить
<p><code>zfs list rpool/swap</code></p>
<li>Подготавливаем его как swap:
<p><code>mkswap /dev/zvol/rpool/swap</code></p>
<li>Добавляем в /etc/fstab
<p><code>/dev/zvol/rpool/swap none swap sw 0 0</code></p>
<li>Активируем:
<p><code>swapon -a</code></p>
<li>Проверяем:
<p><code>swapon -s</code></p>
<p> или
<p><code>free -h</code></p>
</body>
  </html>
