<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Увеличение размра диска</title>
    <link rel="stylesheet" href="../../style.css">
  </head>

<body>
<h2>Расширение диска в Linux (Debian, CentOS, Ubuntu). LVM - не используется!</h2>
<p>Расширение будет выполнено без потери данных.
<p>Cуществующий раздел удаляется, а на его месте создается новый, большего размера.
<p>Будем увеличивать размер <code>/dev/sda</code>
<ol>
<li>Увеличить размер диска на гипервизоре
<p> Если диск не содержит разделов sda1,sda2 и т.д переходим к  пункту 9 <code> resize2fs /dev/sda</code></p>
<li> <code>fdisk /dev/sda</code> Выбираем устройство, а не раздел на этом устройстве
<li> <b>p</b> (print), чтобы увидеть таблицу разделов на диске.
<p>Если есть раздел sda5 (swap) - отключаем Swap и удаляем раздел sda5. Не забываем убрать его из  /etc/fstab
<p>Если есть раздел sda2 (extention) и он не используется (df -h), удаляем его
<li> Удаляем лишние разделы  sda5,sda2 - <b>d</b>
Иначе не сможем расшить sda1
<li>Выполним d для удаления sda1. 
<p>Затем <b>n</b> – для создания нового, <b>p</b> – для primary, <b>1</b> – это номер раздела; 
<p> укажем начало и конец раздела в секторах. 
<br>Начальный сектор должен соответствовать начальному сектору раздела, который был удален. ( это 2048)
<br>Последний сектор раздела выбираем максимально возможным
<li>Проверим. Еще раз <b>p</b> – чтобы убедиться, что раздел теперь увеличился до необходимого нам размера. 
<li> <b>w</b> – запись и выхода из fdisk.
<li>Перезагружаем ОС — <code>reboot</code>
<li>После перезагрузки нам необходимо расширить ФС на весь раздел. 
<p><code>resize2fs /dev/sda1</code></p>
<li><p><code>df -h</code> – проверить, что все получилось.
</ol>
<h2>Расширение диска в Linux (Debian, CentOS, Ubuntu). LVM</h2>
<p>Пробовал на ubuntu 20.Где диск был 127 гб, а размечено было 60ГБ
<ol>
<li>Вывессти инфомацию
<p><code>vgdisplay</code></p>
<li>увеличить размер тома группы на 100%
<p><code>lvextend -l +100%FREE /dev/ubuntu-vg/<ваше_имя_логического_тома></code></p>
<li>расширить файловую систему
<p>Для ext4
<p><code>resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv</code></p>
<li><p><code>df -h</code> – проверить, что все получилось.
</ol>
<h2>Как уменьшить размер файловой системы с ext4?</h2>
<p> Файловая система ext4 штатно поддерживает своё уменьшение, если на ней достаточно свободного места для сжатия. 
<br>В отличие от xfs, которая уменьшение не поддерживает вообще. 
<p>Для того, чтобы уменьшить ext4, её надо обязательно размонтировать. Наживую не получится. Если нужно уменьшить корневой раздел с системой, то в любом случае нужна перезагрузка. 
<ol>
<li>Перед выполнением операции и после рекомендуется проверить файловую систему на ошибки:
<p><code>/sbin/e2fsck -yf /dev/sda1</code></P>
<li>Файловая система на разделе /dev/sda1 будет уменьшена до 50G, если там хватит свободного места для этого. То есть данных должно быть меньше
<p><code>/sbin/resize2fs /dev/sda1 50G</code></P>


В общем случае вам нужно загрузиться с какого-то LiveCD, примонтировать раздел с ext4 и выполнить одну команду
</body>
  </html>
