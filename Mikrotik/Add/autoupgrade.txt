:local BackupPassword "Manipura2010";

/system package update
:put "Check for Update"
check-for-updates once as-value;
:while ([get status] = "finding out latest version...") do={
  :put "checking.."
  :delay 1s;
};

:if ( [get status] = "New version is available") do={
  :log info "New version is available"
  :put "New version is available"  

  /system/backup/cloud/print as-value;
  :if ([ :len [ /system/backup/cloud/find ] ] > 0) do={
    :log info "Replace Old Backup"
    :put "Replace Old Backup"
    /system/backup/cloud/upload-file action=create-and-upload password=$BackupPassword replace=[ get ([ find ]->0) name ] as-value;
  } else={
    :log info "Creating Backup"
    :put "Creating Backup"  
    /system/backup/cloud/upload-file action=create-and-upload password=$BackupPassword as-value;
  }

  :log info "Starting Upgrade"
  :put "Starting Upgrade"  
  /system package update install
}