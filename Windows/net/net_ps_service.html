<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Net Powershell</title>
    <link rel="stylesheet" href="../../style.css">
  </head>

<body>
<h2>Test-NetConnection</h2>
<p>Test-NetConnection или tnc — готовый к использованию командлет для проверки сетевого подключения появился в PowerShell 4.0 (Windows 2012 R2, Windows 8.1)
<ol>
<li> Проверить интернет соединение
<p><code>tnc</code> Оторазит ip и имя сетевой карты, черз коорую идет подключение</p>
<li> Проверить tcp порт
<p><code>tnc i.ua -p 443</code></p>
Не выполнять ping  -InformationLevel Quiet
<p><code>tnc i.ua -port 443 -InformationLevel Quiet</code></p>
<li> Можно указать имя службы (HTTP, RDP, SMB, WINRM)
<p><code>tnc unac.mlp.pp.ua -CommonTCPPort RDP</code></p>
<li>TraceRoute
<p><code>tnc  i.ua   -TraceRoute</code>
</ol>

<h2> Запустить Webserver на 3000 порту</h2>
<p>var 1. Однострочник.
<table><tr><td><pre>
$listener = [System.Net.Sockets.TcpListener]3000; $listener.Start(); while ($true) { $client = $listener.AcceptTcpClient(); $stream = $client.GetStream(); $writer = New-Object System.IO.StreamWriter($stream); $writer.WriteLine("Hello from port 3000"); $writer.Flush(); $client.Close(); }
</pre></td></tr></table>
<p> Поверить
<p><code>netstat -aont | findstr  3000</code>
<p>var 2. Этот скрипт создаёт HTTP-сервер, который отвечает на входящие запросы на порту 3000 простым HTML-контентом. Запустите его в PowerShell с правами администратора.
<table><tr><td><pre>
$listener = [System.Net.HttpListener]::new()
$listener.Prefixes.Add("http://+:3000/")
$listener.Start()
Write-Host "Сервер запущен на порту 3000..."

while ($listener.IsListening) {
    $context = $listener.GetContext()
    $response = $context.Response
    $responseString = "<html><body><h3>PowerShell is WORK!</h3></body></html>"
    $buffer = [System.Text.Encoding]::UTF8.GetBytes($responseString)
    $response.OutputStream.Write($buffer, 0, $buffer.Length)
    $response.Close()
}
</pre></td></tr></table>

</body>
  </html>
